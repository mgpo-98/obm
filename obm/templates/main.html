{% extends 'base.html' %}
{% load django_bootstrap5 %}

{% block content %}
<h2>인기 검색어 순위</h2>
<div>
  <button onclick="updateSearchRank('daily')">일간</button>
  <button onclick="updateSearchRank('weekly')">주간</button>
  <button onclick="updateSearchRank('overall')">전체</button>
</div>
<ul id="searchRank"></ul>
<script>
  function updateSearchRank(period, containerId) {
    $.ajax({
      url: `/get_popular_search_rank/?period=${period}`,
      method: 'GET',
      success: function (data) {
        console.log(`Received ${period} data:`, data);
        updateRankList(data.rank, containerId);
      },
      error: function () {
        console.error(`검색어 순위(${period})를 가져오는 중 오류가 발생했습니다.`);
      }
    });
  }

  function get_arrow(prev_rank, current_rank) {
    console.log('prev_rank', prev_rank);
    console.log('current_rank', current_rank);
    if (prev_rank === 0 && current_rank === 0) {
      return '';  // 변동 없음
    }

    if (prev_rank < current_rank) {
      return '↑';  // 상승 화살표
    } else if (prev_rank > current_rank) {
      return '↓';  // 하락 화살표
    } else {
      return '';  // 변동 없음
    }
  }

  function updateRankList(rank, containerId) {
    console.log('Updating rank list:', rank);
    const searchRankContainer = $(`#${containerId}`);
    searchRankContainer.empty();
    rank.forEach(function (item, index) {
      const arrow = get_arrow(item.prev_rank, item.rank);
      console.log(`Arrow for ${item.query}: ${arrow}`);
      const listItem = $(`<li>${arrow} ${index + 1}. ${item.query} (${item.search_count}회)${item.new}</li>`);
      searchRankContainer.append(listItem);
    });
  }

  // 초기에 전체 순위를 보여줌
  updateSearchRank('overall', 'searchRank');
</script>



{% endblock content %}