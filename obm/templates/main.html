{% extends 'base.html' %}
{% load django_bootstrap5 %}

{% block content %}
<h2>인기 검색어 순위 (일간, 주간, 전체)</h2>
<ul id="dailySearchRank"></ul>
<ul id="weeklySearchRank"></ul>
<ul id="overallSearchRank"></ul>

<script>
  function updateSearchRank(period, containerId) {
    $.ajax({
      url: `/get_popular_search_rank/?period=${period}`,
      method: 'GET',
      success: function (data) {
        console.log(`Received ${period} data:`, data);
        updateRankList(data.rank, containerId);
      },
      error: function () {
        console.error(`검색어 순위(${period})를 가져오는 중 오류가 발생했습니다.`);
      }
    });
  }

  function get_arrow(prev_rank, current_rank) {
    if (typeof prev_rank === 'undefined') {
      return '';  // 이전 순위가 없으면 변동 없음
    }

    const arrow = prev_rank < current_rank ? '↑' : (prev_rank > current_rank ? '↓' : '');
    console.log(`get_arrow(${prev_rank}, ${current_rank}) -> ${arrow}`);
    return arrow;
  }

  function updateRankList(rank, containerId) {
    console.log('Updating rank list:', rank);
    const searchRankContainer = $(`#${containerId}`);
    searchRankContainer.empty();
    rank.forEach(function (item, index) {
      const arrow = get_arrow(item.prev_rank, item.rank);
      console.log(`Arrow for ${item.query}: ${arrow}`);
      const listItem = $(`<li>${arrow} ${index + 1}. ${item.query} (${item.search_count}회)${item.new}</li>`);
      searchRankContainer.append(listItem);
    });
  }

  // 일정 간격으로 검색어 순위 업데이트
  setInterval(() => updateSearchRank('daily', 'dailySearchRank'), 5000);  // 5초마다 업데이트
  setInterval(() => updateSearchRank('weekly', 'weeklySearchRank'), 10000);  // 10초마다 업데이트
  setInterval(() => updateSearchRank('overall', 'overallSearchRank'), 15000);  // 15초마다 업데이트
  updateSearchRank('daily', 'dailySearchRank');  // 페이지 로딩시 초기 검색어 순위 설정
  updateSearchRank('weekly', 'weeklySearchRank');
  updateSearchRank('overall', 'overallSearchRank');
</script>



{% endblock content %}