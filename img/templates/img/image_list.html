{% extends 'base.html' %}
{% load django_bootstrap5 %}
{% load static %}
{% block content %}

<link rel="stylesheet" href="{% static 'img_list.css' %}">



<div class='btn_list'>

    <div class="btn-group" role="group" aria-label="Basic outlined example">
        <button type="button" class="btn btn-outline-primary" onclick="filterImages('all')">전체</button>
        <button type="button" class="btn btn-outline-primary" onclick="filterImages('gif')">GIF</button>
        <button type="button" class="btn btn-outline-primary" onclick="filterImages('normal')">일반</button>
    </div>
    
    <form method="get" action="{% url 'img:image_list' %}" class="select">
        <select name="items_per_page" id="items_per_page">
            <option value="25" {% if items_per_page == 25 %}selected{% endif %}>25</option>
            <option value="50" {% if items_per_page == 50 %}selected{% endif %}>50</option>
            <option value="75" {% if items_per_page == 70 %}selected{% endif %}>75</option>
            <option value="100" {% if items_per_page == 100 %}selected{% endif %}>100</option>
        </select>
        <input type="submit" value="적용">
    </form>
</div>
<ul class='navbox' id='imageList'>
    {% for image in image_items %}
        <li class='img_box' data-category="{{ image.category }}">
            <div>
                <img src="{{ image.image.url }}" alt="Image">
            </div>
            <div class="hashtags">
                <p>{% for hashtag in image.hashtags.all %}
                    <span>{{ hashtag.name }} </span>
                {% endfor %}</p>
            </div>
        </li> 
    {% empty %}
        <p>등록된 이미지가 없습니다.</p>
    {% endfor %}
</ul>
<div id="overlay">
    <span id="download-button">다운로드</span>
</div>


{% comment %} 오킹의 밥줄 {% endcomment %}


<script>
    function filterImages(category) {
        var images = document.querySelectorAll('.img_box');
        images.forEach(function (img) {
            var imgCategory = img.getAttribute('data-category');
            var imgSrc = img.querySelector('img').getAttribute('src');

            if (category === 'all' || (category === 'gif' && imgSrc.endsWith('.gif')) || (category === 'normal' && !imgSrc.endsWith('.gif'))) {
                img.style.display = 'block';
            } else {
                img.style.display = 'none';
            }
        });
    }
</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // 이미지 클릭 시 확대되도록 하는 코드
        var images = document.querySelectorAll('.img_box img');
        var overlay = document.getElementById('overlay');
        var overlayImg = document.createElement('img');
        overlayImg.classList.add('overlay-img');
        overlay.appendChild(overlayImg);

        images.forEach(function (img) {
            img.addEventListener('click', function () {
                overlayImg.src = img.src;
                overlay.style.display = 'flex';
            });
        });

        // 다운로드 버튼 클릭 시 이미지 다운로드
        var downloadButton = document.getElementById('download-button');
        downloadButton.addEventListener('click', function () {
            var link = document.createElement('a');
            link.href = overlayImg.src;
            link.download = 'image.jpg';
            link.click();
        });

        // 오버레이 영역 클릭 시 확대 이미지 숨기기
        overlay.addEventListener('click', function () {
            overlay.style.display = 'none';
        });
    });
</script>

{% endblock content %}
