{% extends 'base.html' %}
{% load django_bootstrap5 %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'upload.css' %}">


<h1>이미지 업로드</h1>
<hr>

<form id="image-upload-form" method="post" enctype="multipart/form-data">
    {% csrf_token %}
    
    <!-- 드래그 앤 드롭 영역 -->
    <div id="drop-area" ondrop="handleDrop(event)" ondragover="handleDragOver(event)">
        <img src="https://img.icons8.com/pastel-glyph/2x/image-file.png" alt="파일 아이콘" class="image">
        <span id="drop-text">이미지를 드래그하여 업로드하세요.</span>
    </div>

    <!-- 파일 입력 필드 -->
    <input type="file" name="image" id="image-input" style="display: none;" onchange="handleFileSelect(event)" >
    <div class="hashtag-btn">
        <input type="text" name="hashtags" id="hashtags-input" placeholder="해시태그를 추가하세요">
        <button type="button" id="add-hashtag-button">해시태그 추가</button>
        <ul id="hashtag-list">
            <!-- 해시태그 목록이 여기에 추가될 것입니다. -->
        </ul>
    </div>
    <input type="submit" id="upload-button" value="이미지 업로드 및 해시태그 저장">
    <span id="file-info"></span>
    
  
</form> 


<script>
    // 드래그 앤 드롭 이벤트 핸들러
    function handleDrop(event) {
        event.preventDefault();
        const files = event.dataTransfer.files;

        // 파일이 하나 이상일 경우 첫 번째 파일을 선택
        if (files.length > 0) {
            const file = files[0];
            document.getElementById('image-input').files = files;
            document.getElementById('drop-text').textContent = `${file.name} 파일이 선택되었습니다.`;
            document.getElementById('file-info').textContent = `선택된 파일: ${file.name}`;
        }
    }
    function handleFileSelect(event) {
        const files = event.target.files;
    
        // 파일이 하나 이상일 경우 첫 번째 파일을 선택
        if (files.length > 0) {
            const file = files[0];
            document.getElementById('drop-text').textContent = `${file.name} 파일이 선택되었습니다.`;
            document.getElementById('file-info').textContent = `선택된 파일: ${file.name}`;
        }
    }
d
    function handleDragOver(event) {
        event.preventDefault();
    }

    document.addEventListener('DOMContentLoaded', function() {
        const addHashtagButton = document.getElementById('add-hashtag-button');
        const hashtagsInput = document.getElementById('hashtags-input');
        const hashtagList = document.getElementById("hashtag-list");

        // 파일 입력 필드 클릭 시 드래그 앤 드롭 영역이 선택되도록 설정
        document.getElementById('image-input').addEventListener('click', function() {
            document.getElementById('drop-area').click();
        });

        // 드래그 앤 드롭 영역 클릭 시 파일 입력 필드가 선택되도록 설정
        document.getElementById('drop-area').addEventListener('click', function() {
            document.getElementById('image-input').click();
        });

        addHashtagButton.addEventListener('click', function() {
            const hashtag = hashtagsInput.value.trim();
            if (hashtag) {
                const hashtagElement = document.createElement("li");
                hashtagElement.textContent = hashtag;
                hashtagList.appendChild(hashtagElement);
                hashtagsInput.value = ''; // 입력 필드 지우기
            }
        });
    
        const uploadForm = document.getElementById('image-upload-form');
        uploadForm.addEventListener('submit', function(event) {
            event.preventDefault();
            const hashtags = Array.from(hashtagList.getElementsByTagName('li'))
            .map(hashtagElement => hashtagElement.textContent)
            .join(', ');
            
            const hashtagsInput = document.createElement('input');
            hashtagsInput.type = 'hidden';
            hashtagsInput.name = 'hashtags';
            hashtagsInput.value = JSON.stringify(hashtags);
            uploadForm.appendChild(hashtagsInput);
        
            // 이미지 업로드 및 해시태그 등록 요청을 보냅니다.
            fetch('/img/', {
                method: 'POST',
                body: new FormData(uploadForm),
            })
            .then(response => response.json())
            .then(data => {
                console.log('업로드 성공');
                // 업로드 성공 시 이미지 리스트 페이지로 리디렉션합니다.
                window.location.href = '{% url "img:image_list" %}';
            })
            .catch(error => {
                console.error('업로드 중 오류 발생: ', error);
            });
        });
    });
</script>

{% endblock content %}